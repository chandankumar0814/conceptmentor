<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Birla Open Minds International School - Cyber Awareness Results</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial;
    margin:0;
    background:linear-gradient(135deg,#8B0000,#FF6F00);
    text-align:center;
    color:white;
}
.header{
    background:white;
    padding:20px;
    color:#8B0000;
}
.header img{ width:120px; }
.school-name{ font-size:22px; font-weight:bold; }
.school-location{ font-size:16px; color:#444; }
.container{ width:95%; max-width:1200px; margin:auto; }
.section{
    background:rgba(255,255,255,0.15);
    margin:20px 0;
    padding:15px;
    border-radius:12px;
}
table{
    width:100%;
    border-collapse:collapse;
    background:white;
    color:black;
}
th,td{
    padding:8px;
    border-bottom:1px solid #ddd;
    font-size:14px;
}
th{
    background:#8B0000;
    color:white;
}
button{
    padding:6px 10px;
    background:#8B0000;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
}
footer{
    background:#8B0000;
    padding:10px;
    margin-top:30px;
}

.gallery{
    display:flex;
    justify-content:center;
    gap:15px;
    flex-wrap:wrap;
    margin-top:15px;
}

.gallery img{
    width:200px;
    height:150px;
    object-fit:cover;
    border-radius:10px;
    border:3px solid white;
    transition:transform 0.3s;
}

.gallery img:hover{
    transform:scale(1.05);
}

/* LIGHTBOX */

.lightbox{
    display:none;
    position:fixed;
    z-index:999;
    left:0;
    top:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.9);
    justify-content:center;
    align-items:center;
}

.lightbox img{
    max-width:90%;
    max-height:90%;
    border-radius:10px;
}

.lightbox span{
    position:absolute;
    top:20px;
    right:40px;
    font-size:40px;
    color:white;
    cursor:pointer;
}
    
</style>
</head>

<body>

<div class="header">
    <img src="logo.png">
    <div class="school-name">Birla Open Minds International School</div>
    <div class="school-location">Purnea</div>
</div>

<h2>üèÜ Cyber Awareness Quiz 2026 Results</h2>

<div class="container">
<div id="classBoards"></div>
</div>

<footer>
¬© 2026 Birla Open Minds International School, Purnea
</footer>

<script>

const grades={
"grade3.xlsx":100,
"grade4.xlsx":96,
"grade5.xlsx":124,
"grade6.xlsx":54,
"grade7.xlsx":60
};

let overallData=[];
let combined567=[];
let classDataStore={};

function toSentenceCase(name){
    return name.toLowerCase().split(" ")
    .map(word=>word.charAt(0).toUpperCase()+word.slice(1))
    .join(" ");
}

async function loadExcel(file){

let totalMarks = grades[file];
let res = await fetch(file);
let data = await res.arrayBuffer();
let wb = XLSX.read(data);
let sheet = wb.Sheets[wb.SheetNames[0]];
let json = XLSX.utils.sheet_to_json(sheet);

let students=[];

json.forEach(row=>{

    let name="", score="";

    for(let key in row){
        let lower=key.toLowerCase();
        if(lower.includes("name")) name=row[key];
        if(lower.includes("score")) score=row[key];
    }

    score=parseFloat(score);

    if(name && !isNaN(score)){

        let percent=((score/totalMarks)*100).toFixed(2);
        let gradeNumber=parseInt(file.replace(/[^0-9]/g,""));
        let grade="Grade "+gradeNumber;

        let obj={
            name:toSentenceCase(name.trim()),
            percent:parseFloat(percent),
            grade:grade,
            combinedRank:0
        };

        students.push(obj);
        overallData.push(obj);

        if(gradeNumber===5||gradeNumber===6||gradeNumber===7){
            combined567.push(obj);
        }
    }
});

students.sort((a,b)=>b.percent-a.percent);
classDataStore[file.replace(".xlsx","")]=students;
}

/* Combined ranking for 5,6,7 */
function rankCombined567(){
combined567.sort((a,b)=>b.percent-a.percent);
for(let i=0;i<3 && i<combined567.length;i++){
    combined567[i].combinedRank=i+1;
}
}

/* Leaderboard */
function createClassBoard(title,data){

let gradeNumber=parseInt(title.replace(/[^0-9]/g,""));
let div=document.createElement("div");
div.className="section";

let html=`<h2>Grade ${gradeNumber} Leaderboard</h2>
<table>
<tr><th>Rank</th><th>Name</th><th>%</th><th>Certificate</th></tr>`;

data.forEach((s,i)=>{

let rankDisplay="-";
let rankValue=0;

/* Grade 3 & 4 */
if(gradeNumber===3||gradeNumber===4){
    if(i===0){rankDisplay="1st";rankValue=1;}
    else if(i===1){rankDisplay="2nd";rankValue=2;}
    else if(i===2){rankDisplay="3rd";rankValue=3;}
}

/* Grades 5,6,7 Combined */
if(gradeNumber===5||gradeNumber===6||gradeNumber===7){
    if(s.combinedRank===1){rankDisplay="1st";rankValue=1;}
    else if(s.combinedRank===2){rankDisplay="2nd";rankValue=2;}
    else if(s.combinedRank===3){rankDisplay="3rd";rankValue=3;}
}

html+=`<tr>
<td>${rankDisplay}</td>
<td>${s.name}</td>
<td>${s.percent}%</td>
<td>
<button onclick="downloadCertificate('${s.name}',${s.percent},'${s.grade}',${rankValue})">
Download
</button>
</td>
</tr>`;
});

html+="</table>";

/* ===== ADD GRADE PHOTOS ===== */

html+=`
<h3 style="margin-top:20px;">üì∏ Competition Moments</h3>
<div class="gallery">
<img src="image${gradeNumber}.jpeg" onclick="openImage(this.src)">
<img src="image${gradeNumber}1.jpeg" onclick="openImage(this.src)">
</div>
`;
div.innerHTML=html;
document.getElementById("classBoards").appendChild(div);
}

/* Certificate */

function downloadCertificate(name, percent, grade, rank){

const { jsPDF } = window.jspdf;
let doc = new jsPDF("landscape");

let pageWidth = doc.internal.pageSize.getWidth();
let pageHeight = doc.internal.pageSize.getHeight();

/* ================= BORDER DESIGN ================= */

doc.setDrawColor(139,0,0);
doc.setLineWidth(4);
doc.rect(10,10,pageWidth-20,pageHeight-20);

doc.setDrawColor(255,140,0);
doc.setLineWidth(1.5);
doc.rect(18,18,pageWidth-36,pageHeight-36);

/* ================= SCHOOL NAME ================= */

doc.setFont("helvetica","bold");
doc.setFontSize(28);
doc.setTextColor(139,0,0);
doc.text("Birla Open Minds International School", pageWidth/2, 35, {align:"center"});

doc.setFontSize(16);
doc.setTextColor(80,80,80);
doc.text("Purnea", pageWidth/2, 45, {align:"center"});

/* ================= TITLE ================= */

let isWinner = rank > 0;

doc.setFontSize(26);
doc.setTextColor(0,0,0);

if(isWinner){
    doc.text("Certificate of Achievement", pageWidth/2, 70, {align:"center"});
}else{
    doc.text("Certificate of Participation", pageWidth/2, 70, {align:"center"});
}

/* ================= BODY TEXT ================= */

doc.setFontSize(16);
doc.setTextColor(0,0,0);
doc.text("This certificate is proudly presented to", pageWidth/2, 95, {align:"center"});

/* ================= STUDENT NAME ================= */

doc.setFontSize(32);
doc.setTextColor(0,0,139);
doc.text(name, pageWidth/2, 115, {align:"center"});

/* ================= DETAILS ================= */

doc.setFontSize(18);
doc.setTextColor(0,0,0);
doc.text(`Class: ${grade}`, pageWidth/2, 130, {align:"center"});
doc.text(`Score: ${percent}%`, pageWidth/2, 142, {align:"center"});

/* ================= RANK MESSAGE ================= */

if(isWinner){

let rankText = rank==1 ? "1st Rank"
             : rank==2 ? "2nd Rank"
             : "3rd Rank";

doc.setFontSize(20);
doc.setTextColor(139,0,0);
doc.text(`Secured ${rankText} in Cyber Awareness Quiz 2026`, pageWidth/2, 160, {align:"center"});

}else{

doc.setFontSize(18);
doc.setTextColor(0,0,0);
doc.text("For active participation in Cyber Awareness Quiz 2026", pageWidth/2, 160, {align:"center"});
}

/* ================= DATE ================= */

let today = "21/02/2026";

doc.setFontSize(14);
doc.setTextColor(0,0,0);
doc.text(`Date: ${today}`, 30, pageHeight-35);

/* ================= SIGNATURE ================= */

doc.line(pageWidth-100, pageHeight-45, pageWidth-40, pageHeight-45);
doc.setFontSize(14);
doc.text("Principal", pageWidth-70, pageHeight-30, {align:"center"});

/* ================= SAVE ================= */

doc.save(name+"_Certificate.pdf");
}
    
async function init(){
for(let f in grades){ await loadExcel(f); }
rankCombined567();
for(let className in classDataStore){
    createClassBoard(className,classDataStore[className]);
}
confetti({particleCount:200,spread:120});
}

function openImage(src){
    document.getElementById("lightbox").style.display="flex";
    document.getElementById("lightbox-img").src=src;
}

function closeImage(){
    document.getElementById("lightbox").style.display="none";
}

init();

</script>

<div id="lightbox" class="lightbox">
<span onclick="closeImage()">√ó</span>
<img id="lightbox-img">
</div>
    
</body>
</html>
